---
title: "Introduction to R"
subtitle: "Adaptation based on Nelson Areal' session"
author: "Nelson Areal / Miguel Portela"
date: 'October, 2023'
output: html_notebook
---


# 1. Introduction

- Applications of R: Statistics, Data Science, Machine Learning, Visualization, etc.

# 2. Setting Up R

## Installing R and RStudio: Step-by-step process

A. Create an account in [Posit cloud](https://posit.cloud/). You can use your gmail account.

B. Install R and RStudio: [RStudio Desktop](https://posit.co/download/rstudio-desktop/)


## Understanding the RStudio Interface: Console, script, environment, plots, and packages panes

- **Four Main Panes**:
  - **Console Pane**: 
    - Primary interface to interact with R.
    - Execute R commands line by line.
    - Displays outputs and error messages.
  - **Script Pane**:
    - Create, view, and edit scripts or R markdown files.
    - Run individual lines or chunks of code directly from the script.
  - **Environment/History Pane**:
    - **Environment**: Displays variables, data frames, and other objects in the current workspace.
    - **History**: Shows a log of past commands executed in the console.
  - **Files/Plots/Packages/Help Pane**:
    - **Files**: Navigate through directories and manage files.
    - **Plots**: View plots and graphs generated by your R code.
    - **Packages**: Install, view, and load R packages.
    - **Help**: Access R documentation and search for functions or packages.

- **Toolbar**:
  - **New Script**: Start a new R script or R Markdown file.
  - **Open Script**: Open an existing script from your files.
  - **Save**: Save the current script.
  - **Run Code**: Execute selected lines or chunks of code.

- **Global Environment**:
  - Clear objects from memory using the broom icon.
  - Import datasets directly via the "Import Dataset" dropdown.

- **Integrated Terminal and Git**:
  - Access a system terminal directly within RStudio.
  - Version control and Git integration for managing code repositories.

- **Customizable Layout**:
  - Adjust pane sizes by dragging borders.
  - Navigate to `View` > `Panes` to modify the layout according to preference.

- **Themes and Appearance**:
  - Personalize the look of RStudio through `Tools` > `Global Options` > `Appearance`.

- **Keyboard Shortcuts**:
  - Boost productivity with key combinations, e.g., `Ctrl + Enter` to run a line of code.
  - Access a list of shortcuts via `Help` > `Keyboard Shortcuts Help`.


# 3. Basics of R

### 3. Basics of R

#### Basic Arithmetic:
- **Addition**: `5 + 3` results in `8`
- **Subtraction**: `10 - 7` results in `3`
- **Multiplication**: `4 * 2` results in `8`
- **Division**: `8 / 2` results in `4`


```{r}
1 + 2 # addition
1 - 2 # subtraction
2 * 3 # multiplication
2 / 3 # division
2^3 # exponent
3 %% 2 # reminder
5 %/% 2 # integer division
```


#### Objects and Assignment:
- **`<-` operator**: Used for assignment in R
  - Example: `x <- 10` assigns the value `10` to the variable `x`.
- **Creating variables**: Simply name a variable and assign it a value using the `<-` operator.
  - Example: `my_variable <- "Hello, R!"`

#### Data Types:
- **Numeric**: Represents numbers
  - Example: `3.14`
- **Character**: Represents strings or text
  - Example: `"R is fun!"`
- **Logical**: Represents `TRUE` or `FALSE` values
  - Example: `(5 > 3)` results in `TRUE`

#### Data Structures:
- **Vector**: A sequence of elements of the same type
  - Example: `c(1, 2, 3, 4, 5)`
- **Matrix**: A two-dimensional array where each element has the same mode (numeric, character, etc.)
  - Example: `matrix(1:6, nrow=2)`
- **List**: A collection of objects, which can be of different types
  - Example: `list(name="Alice", age=25, scores=c(85, 90, 88))`
- **Data frame**: A table-like structure where columns can be of different types but rows must be of the same length
  - Example: `data.frame(name=c("Alice", "Bob"), age=c(25, 30))`
- **Factors**: Categorical data, can be ordered or unordered
  - Example: `factor(c("small", "medium", "small", "large"))`



## Comparisons

```{r}
1 == 1
2 != 1
2 < 1
2 > 1
2 <= 2
3 >= 2 
```

```{r}
!(1 == 1)
(2 < 1) & (3 > 2)
(2 > 1) | (1 > 2)
```

Comparing characters
```{r}
"a" == "A"
"a" == "a"
"j" > "z"
```


# Functions

> A **function** is group of instructions. They may take an input (parameters) and usually return a value (result).

Examples of functions usage:
```{r}
rnorm(10)
rnorm(10, mean=10, sd=1)
rnorm(10, m=10, s=1)
getwd()
```

`summary()` is an example of a *generic function*, we can find the different methods associated with this function using:

```{r}
methods(summary)
```

```{r}
args(rnorm)
```


# Variables and objects

> In R everything is an object, and an object is an instance of a class.

> Objects have attributes and methods that depend on their class.

> If you are used to object oriented programming this makes immediate sense to you. However, beware that the class system in R is different from many other languages.

# Variables

> Variables in R can can hold values (numeric or otherwise), but also output of functions, or even functions. Variables can hold any R object.

> Since R is a dynamically typed language we don't need to define variable types.

Assigning a value to an object:

> R has two assignment operators: = and <-

```{r}
a <- 5
a
a <- "ten"
a
```

> But it is considered good practice to use <-

We can print the value stored in a variable using:
```{r}
a <- 6
print(a)
```

> Variable names can contain any combination of alphanumeric characters along with periods (.) and underscores (_).

> A few other naming rules:

1. They cannot start with a number or an underscore
2. If they start with a dot (.) the character cannot be a number.

All of the following are valid variable names:
```{r}
.a <- 1
a.b <- 1
a_b <- 1
a1 <- 1
```

Names are case sensitive:
```{r}
a <- 1
A <- 2
a == A
```

R has very few reserved words!
```{r}
?"Reserved"
```


We can inspect an object in RStudio using the `View()` function
```{r, eval=FALSE}
View(a)  
```

To remove variables:
```{r}
rm(a)
```

# R data types

```{r}
typeof(TRUE)
typeof(1L)
typeof(1)
typeof("test")
typeof(1 + 2i) 
```

We can check the type of an object using the functions `is.character()`, `is.double()`, `is.integer()`, `is.logical()`, `is.complex()`
```{r}
is.logical(TRUE)
is.integer(1L)
is.double(1)
is.character("test")
is.complex(1 + 2i) 
```


# Data structures

> R has several data structures:

1. vectors (one-dimensional) *Homogeneous*
2. matrices (two-dimensional) *Homogeneous*
3. lists (multi-dimensional) *Heterogeneous*
4. data.frames (two-dimensional) *Heterogeneous*
4. arrays (multi-dimensional) *Homogeneous*


## Vectors

> A vector can be thought of as contiguous cells containing data.

> They are the primary data type in R.

> A vector can be:

- atomic: all elements are of the same type
- lists: the elements of lists can be of different types.

A vector can be created by concatenating values:
```{r}
c(1,2,5)
```

or by creating sequences.

> We can create a sequence using the colon (:) operator or the seq() function:

```{r}
1:10
seq(from=1, to=30, by=4)
seq(from=0.1, to=1, length=10)
```

> We can repeat values with rep()

```{r}
rep(1, 10)
rep(c(1,2,3),3)
```

The function `vector()` also creates vectors:
```{r}
a_vector <- vector(mode = "numeric", length=2)
```


Some examples of vectors:
```{r}
a_vector <- 1:10
b_vector <- c(1L,2L)
d_vector <- 1
e_vector <- c(TRUE, TRUE, FALSE)
f_vector <- c(1, "a")
```

Strings:
```{r}
a_string <- "test"
length(a_string)
nchar(a_string)
```

Vector arithmetic:
```{r}
x <- 1:10
x + 2 
x * 2 
x / 2
y <- 1:5
x + y 
x * y
sqrt(x)
```

```{r}
typeof(x)
length(x)
```

Beware of vector recycling!

> When performing operations on vectors requiring them to be the same length, R will proceed even if they are not of the same length. This is done by repeating the shorter one until it matches the length of the larger vector.

Some useful functions:
```{r}
x <- 1:20
mean(x) # average
sd(x) # standard deviation
var(x) # variance of x
min(x) # min
max(x) # max
abs(x) # absolute value
sum(x) # summation
```


We can do vectorized comparisons with vectors:
```{r}
x <- 1:10
x >= 5
```

Other handy functions for vector comparisons:
```{r}
x <- 1:10
y <- 10:1
x > y
any(x > y)
all(x > y)
```

Named vectors

> We can name vector elements on creation or afterwards using `names()`

```{r}
x <- c(a = 1, b = 2, c = 3)
x
y <- 1:3
names(y) <- c("a", "b", "c")
all.equal(x, y)
identical(x, y)
```

R missing values are defined by `NA`
```{r}
x <- c(1, NA, 5)
is.na(x)
mean(x)
mean(x, na.rm=TRUE)
```

Removing missing values with `na.omit()`:
```{r}
x <- c(1, NA, 5, NA)
na.omit(x)
```


`NULL` values in R:
```{r}
x <- c(1, NA, 5)
x
x <- NULL
x
is.null(x)
```

> In R NULL correspond to nothing (absence of anything).

Comparing `NA` and `NULL`:
```{r}
x <- NA
length(x)
x <- NULL
length(x)
```

> We can also do explicit coercion of objects with the as. functions:

Converting types (explicit coercion):
```{r}
x <- 0:10
as.character(x)
as.logical(x)
x <- c("a", "b", "c")
as.numeric(x)
```

Slicing vectors:
```{r}
x <- 10:18
```

```{r}
x[3]

x[2:9]
x[2:12]

```

Filtering vectors

> Filtering consists of extracting elements of a vector that satisfy a given condition

```{r}
filtered_values <- x[x > 15]
print(filtered_values)
```


Getting the vector positions that satisfy a condition:
```{r, echo=FALSE}
positions <- which(x > 15)
print(positions)
```

Filtering in assignments:
```{r}
x <- 10:18
x[x > 15] <- 999
print(x)
```
> We can also use subset() to select the even elements:

```{r}
x <- 10:18
x[x%%2 == 0]
#> [1] 10 12 14 16 18
subset(x, x%%2 == 0)
#> [1] 10 12 14 16 18
```

```{r}
x <- 10:18
which(x%%2 == 0)
#> [1] 1 3 5 7 9
x[which(x%%2 == 0)]
#> [1] 10 12 14 16 18
```



## Matrices

Creating a matrix with the `matrix()` function:
```{r}
y <- matrix(1:20, nrow=4, ncol=5)
y
```

Getting additional info from the matrix object:
```{r}
attributes(y)
dim(y)
nrow(y)
ncol(y)
class(y)
is.matrix(y)
```

Useful functions to inspect large matrices:
```{r eval=FALSE}
str(y) # Display the structure of the object
View(y)
```

Creating matrices by row:
```{r}
y <- matrix(1:20, nrow=4, ncol=5, byrow=TRUE)
y
```

Or, create an empty matrix:
```{r}
y <- matrix(nrow=4, ncol=5)
y
```

... and fill it, element by element:
```{r}
y[,1] <- 1:4
y[4,5] <- 10
y 
```

Math with matrices:
```{r}
x <- matrix(1:4, ncol=2)
x
y <- matrix(5:8, ncol=2)
y
x + y # Addition 
x - y # Subtraction
```


```{r}
x %*% y # Matrix multiplication
x * y # Element by element multiplication
```

```{r}
x * 10
```

```{r}
x / y # Element by element division
x / 10 # Division by scalar
```

Transpose of a matrix:
```{r}
t(x)
```

Inverse of a Matrix:
```{r}
inv_x <- solve(x)
inv_x %*% x
```

Object recycling:
```{r}
x + c(1,2)
```

## Matrix indexing

```{r}
x <- matrix(1:15, nrow=3)
x
```

Select the elements in the 2nd line:

```{r}
x[2,]
```

> In matrix x <- matrix(1:15, nrow=3) select all lines in columns 2 to 4

```{r}
result <- x[, 2:4]
print(result)
```

Deleting a matrix row:
```{r}
x[-2, ]
x[-c(1, 3), ]
```

Deleting columns:
```{r}
x <- x[, -2]
print(x)
```

It is easy to add more rows to a matrix:
```{r}
x <- matrix(1:15, nrow=3)
x <- rbind(x, 20:24)
x
```

or more columns:
```{r}
x <- matrix(1:15, nrow=3)
x <- cbind(0, x, 10)
x
```

We can create matrices by binding vectors:
```{r}
y <- cbind(x1 = c(1:3), x2 = c(4:6))
y
colnames(y)
```

We can add row names using:
```{r}
rownames(y) <- LETTERS[1:3]
y
attributes(y)
dimnames(y)
rownames(y)
```

Lets compute the mean of each column of a matrix using `apply()`:
```{r}
x <- matrix(rnorm(15), nrow=3)
colnames(x) <- LETTERS[1:5]
x
apply(x, MARGIN=2, FUN=mean)
apply(x, 2, FUN=mean)
```
or compute the mean by row:
```{r}
apply(x, 1, FUN=mean)
```

Alternatively, we can use the following functions:
```{r}
colSums (x)
rowSums (x)
colMeans(x)
rowMeans(x)
```


Let's look at the following example:
```{r}
x <- matrix(1:4, ncol=2)
y <- x[1, ] 
```

Is `y` a matrix?
```{r}
dim(y)
# or 
attributes(y)
# or
is.matrix(y)
```

To avoid matrix reduction we should instead do:
```{r}
x
y <- x[1, , drop=FALSE]
y
dim(y)
is.matrix(y)
```

Filtering a Matrix:
```{r}
mat <- matrix(1:9, ncol=3)
mat
mat[mat > 5] <- 0
print(mat)
```


## Arrays

We can create an array using:
```{r}
x <- array(1:12, c(2,2,3))
x
```

```{r}
dim(x)
```

Is `x` an array?
```{r}
is.array(x)
```

Subsetting arrays:
```{r}
x[1,1,]
x[,,1]
x[x > 5]
```

## Lists

Lists can be created using the `list()` function:
```{r}
a_list <- list(x = 1:2, y = LETTERS[1:4], z = c(T, F))
b_list <- list(m = matrix(1:10, ncol=2), alphabet = letters)
c_list <- list(1:10, matrix(1:10, ncol=2))
```

We can get the attributes of a list:
```{r}
attributes(a_list)
attributes(c_list)
```

and their element names:
```{r}
names(a_list)
names(c_list)
```

We can remove the names of list by:
```{r}
h_list <- a_list
names(h_list) <- NULL
h_list
# or 
unname(a_list)
```


To check if an object is a list do:
```{r}
is.list(a_list)
# or
class(a_list)
```

We can subset a named lists using the `$` operator:
```{r}
a_list$x
b_list$alphabet
```

or use the `[[]]` operator:
```{r}
a_list[[1]]
b_list[["alphabet"]]
c_list[[1]]
```


There is also the alternative `[]` operator
```{r}
a_list[1]
b_list["alphabet"]
c_list[1]
```

What is the difference between `[]` and `[[]]`?


Lists can also me created using the `vector()` function:
```{r}
d_list <- vector(mode="list") 
d_list[["alphabet"]] <- letters
d_list
```

Adding more components to a list:
```{r}
a_list$w <- "A string"
a_list[[5]] <- 1:5
a_list
```

Removing list components:
```{r}
a_list$w <- NULL
a_list[[5]] <- NULL
a_list
```

Lists can be concatenated:
```{r}
f_list <- c(b_list, c_list)
```

To obtain the size of a list we do:
```{r}
length(f_list) # Number of list components
```

There are special apply functions to lists. They are:`lapply()` or `sapply()`:
```{r}
j_list <- list(a=rnorm(10), b=rnorm(20), c=rnorm(15))
lapply(j_list, mean)
sapply(j_list, mean)
```

```{r}
unlist(lapply(j_list, mean))
```


Lists of lists:
```{r}
inception_list <- list(a_list, b_list, c_list)
inception_list <- list(a = a_list, b = b_list, c = c_list)
```


## Data.frames

```{r}
set.seed(12345)
a_df <- data.frame(subject = letters[1:15], 
                   height = rnorm(15, 170, 5), 
                   weight=rnorm(15, 70, 10), 
                   stringsAsFactors = FALSE)
```

Check if the object `a_df` is a data frame:
```{r}
is.data.frame(a_df)
class(a_df)
```

Data frame attributes:
```{r}
attributes(a_df)
dim(a_df)
length(a_df)
nrow(a_df)
ncol(a_df)
names(a_df)
```

Inspecting a data.frame:
```{r eval=FALSE}
View(a_df)
str(a_df)
summary(a_df)
head(a_df)
tail(a_df)
```

Subsetting a data.frame using the `$` operator:
```{r}
a_df$subject
```

But we can also use `[]`:
```{r}
a_df[2:3, ]
a_df[2:3, 1]
```

or:
```{r}
a_df[2:3, "subject"]
a_df["subject"]
class(a_df["subject"])
a_df[,"subject"]
class(a_df[, "subject"])
a_df[["subject"]]
class(a_df[["subject"]])
```

Select all subjects with height greater than 170:
```{r}
a_df[a_df$height > 170,]
```

Select all subjects with height **less** than 170 and weight **greater** than 75:
```{r}
a_df[a_df$height < 170 & a_df$weight < 65,]
```


Create the BMI column as the person's weight in kilograms divided by the square of height in meters:
```{r}
a_df$bmi <- a_df$weight/((a_df$height/100)^2)
```

Now we can select the subjects overweight (25 < bmi < 30):
```{r}
a_df[a_df$bmi < 30 & a_df$bmi > 25, ]
subset(a_df, a_df$bmi < 30 & a_df$bmi > 25)
```

To remove a column of a data frame:
```{r}
b_df <- a_df
b_df$bmi <- NULL
head(b_df)
```

Filtering a dataframe:
```{r}
df <- data.frame(name=c("Alice", "Bob", "Charlie"), age=c(45, 55, 30))
df$age[df$age > 50] <- 50
print(df)
```


### 4. Basic Operations in R

#### Reading and Writing Data:

- Use `read.csv()` to read comma-separated value files into R.

```{r}
data <- read.csv("data/nlswork.csv")
head(data)
```

- Save a data frame to a CSV file using `write.csv()`.

```{r}
write.csv(data, "data/nlswork_copy.csv")
```

#### Data Manipulation Basics:

- **Accessing elements**: Access data frame columns using the `$` operator.

```{r}
str(data)
column_data <- data$age
column_data
```

- **Subsetting**: Extract subsets of rows based on conditions.

```{r}
subset_data <- data[data$age > 32, ]
View(subset_data)
```

- **Filtering**: Use logical conditions to filter data.

```{r}
filtered_data <- subset(data, age == 27)
```

- **Sorting data**: Sort a data frame based on a column.

```{r}
sorted_data <- data[order(data$age), ]
```

#### Basic Functions:

- **Mean**: Calculate the average of numeric data.

```{r}
avg <- mean(data$age)
avg

avg <- mean(data$age,na.rm = TRUE)
avg
```

- **Median**: Find the median value.

```{r}
med <- median(data$age,na.rm = TRUE)
med
```

```{r}
data_clean_base <- data[!is.na(data$age),]
data_clean <- na.omit(data)
```


- **Sum**: Calculate the total of numeric values.

```{r}
total <- sum(data_clean_base$age)
total
total <- sum(data_clean$age)
total
```

- **Standard Deviation**: Calculate the spread of numeric data.

```{r}
deviation <- sd(data_clean$age)
deviation
```

## LINKS

<!--- https://www.econometrics-with-r.org/ -->

<!--- https://www.andrew.cmu.edu/user/achoulde/94842/lectures/lecture07/lecture07-94842.html -->


